<ion-header translucent="true">
  <ion-toolbar>
    <ion-title>üè¢ Registrar Servicios</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding">

  <form [formGroup]="servicesForm" (ngSubmit)="onSubmit()">
    <ion-list lines="full" class="service-list" formArrayName="data">

      <ion-accordion-group expand="inset">
        <ion-accordion *ngFor="let service of services.controls; let i = index" [value]="i" [formGroupName]="i">
          <ion-item slot="header" detail="true">
            <ion-label>
              <h2>Servicio {{ i + 1 }}</h2>
              <p>{{ (services.at(i).value?.name || 'Sin nombre') | slice:0:40 }}</p>
            </ion-label>
            <ion-buttons slot="end">
              <ion-button fill="clear" color="danger" (click)="removeServiceForm(i)" type="button">
                Eliminar
              </ion-button>
            </ion-buttons>
          </ion-item>

          <div class="accordion-content" slot="content">
            <ion-list class="group-fields" lines="none">

              <ion-item *ngIf="isValidates">
                <ion-label position="stacked">Proveedor</ion-label>
                <fac-select
                  formControlName="providers"
                  placeholder="Seleccione proveedor"
                  [valueField]="'id'"
                  [labelField]="'name'"
                  [items]="providerList"
                  (ionChange)="onProvidersSelected($event)">
                </fac-select>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Categor√≠a</ion-label>
                <fac-select
                  formControlName="category"
                  placeholder="Seleccione categor√≠a"
                  [valueField]="'id'"
                  [labelField]="'name'"
                  [items]="categoryAll"
                  (ionChange)="onSubCategory($event)">
                </fac-select>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Subcategor√≠a</ion-label>
                <fac-select
                  formControlName="subcategory"
                  placeholder="Seleccione subcategor√≠a"
                  [valueField]="'id'"
                  [labelField]="'name'"
                  [items]="getAvailableSubcategories(i)"
                  (ionChange)="onSelectItem($event,i)">
                </fac-select>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Nombre</ion-label>
                <fac-input
                  formControlName="name"
                  type="text"
                  placeholder="Ingrese el nombre del servicio"
                  icon="person">
                </fac-input>
              </ion-item>

              <ion-item>
                <ion-label position="stacked">Descripci√≥n</ion-label>
                <fac-textarea
                  formControlName="description"
                  placeholder="Ingrese una descripci√≥n"
                  icon="document-text">
                </fac-textarea>
              </ion-item>

              <div class="two-cols">
                <ion-item>
                  <ion-label position="stacked">Tiempo (min)</ion-label>
                  <fac-input
                    formControlName="serviceTime"
                    type="number"
                    placeholder="Ej: 45">
                  </fac-input>
                </ion-item>

                <ion-item>
                  <ion-label position="stacked">Precio</ion-label>
                  <fac-input
                    formControlName="price"
                    type="number"
                    placeholder="Ej: 50000">
                  </fac-input>
                </ion-item>
              </div>

            </ion-list>
          </div>
        </ion-accordion>
      </ion-accordion-group>

    </ion-list>

    <div class="stack-actions">
      <ion-button expand="block" color="primary" type="button" (click)="addServiceForm()">
        + Agregar servicio
      </ion-button>

      <ion-button expand="block" color="primary" type="submit" [disabled]="servicesForm.invalid">
        Guardar
      </ion-button>
    </div>
  </form>

</ion-content>
