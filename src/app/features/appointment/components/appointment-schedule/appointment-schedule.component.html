<div class="schedule">
  <!-- Selector de días -->
  <div class="day-selector">
    <ion-segment scrollable [(ngModel)]="activeDayValue" class="day-segment" #daySegment>
      <ion-segment-button
        *ngFor="let day of days; let i = index"
        [value]="day.fullDate.toISOString()"
        (click)="setActiveDay(day)">
        <div class="day-card" [class.active]="day.active">
          <small>{{ day.name }}</small>
          <strong>{{ day.date }}</strong>
        </div>
      </ion-segment-button>
    </ion-segment>
  </div>

  <!-- Título -->
  <h2 class="section-title">This Day’s Plan</h2>

  <!-- Lista con scroll virtual -->
  <cdk-virtual-scroll-viewport [itemSize]="TASK_ROW_SIZE" class="tasks-scroll">
    <ion-item-sliding *cdkVirtualFor="let task of tasks">
      <ion-item lines="none" class="task-card">
        <div class="indicator" [style.background]="task.color"></div>

        <div class="task-body">
          <div class="task-title-row">
            <div class="task-title">{{ task.title }}</div>
          </div>

          <div class="task-meta">
            <span class="time">{{ task.time }}</span>
            <span *ngIf="task.tag" class="tag">{{ task.tag }}</span>
          </div>

          <div class="task-subtitle" *ngIf="task.subtitle">{{ task.subtitle }}</div>

          <!-- ÚNICA ACCIÓN: Agendar -->
          <ion-button
            class="book-btn"
            expand="block"
            size="small"
            (click)="onBook(task)">
            <ion-icon name="calendar-outline" slot="start"></ion-icon>
            Agendar
          </ion-button>
        </div>
      </ion-item>
    </ion-item-sliding>
  </cdk-virtual-scroll-viewport>
</div>
